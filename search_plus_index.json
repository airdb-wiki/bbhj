{"./":{"url":"./","title":"Introduction","keywords":"","body":"宝贝回家 小程序 后端 论坛 共享文档(工作事项): 腾讯文档 思维导图(小程序要做什么？): 百度脑图 设计图: 蓝湖 Slides(为什么要做这样一件事): slides.com 项目进度: waffle.io Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/intro.html":{"url":"wiki/intro.html","title":"intro","keywords":"","body":"项目介绍 宝贝回家寻子网是隶属于宝贝回家志愿者协会的公益网站，在本网站登记寻亲信息及本站志愿者提供的所有寻人服务均不收取任何费用，宝贝回家志愿者协会是已在民政部门正式注册的民间志愿者组织，是独具法人资格的地方性非营利社会公益团体。 概况 宝贝回家是国内最大的寻人平台，组织成立超过 10 年，论坛累计注册用户数超过 30 万。 网站 宝贝回家官网 论坛 机器人 QQ 机器人 微信机器人 小程序 小程序 mina 给个小星星，star 一下吧 :) Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/team.html":{"url":"wiki/team.html","title":"team","keywords":"","body":"团队建设 宝贝回家技术公益团队于2018年初逐步建立，以“技术改变公益”为理念，服务于公益组织或社会团体。涉足领域包括，网站论坛运维，站点开发，小程序开发等, 目前有产品，项目、开发、设计、运营等岗位。 如果您和我们有共同的想法或目标，欢迎加入。 成员介绍 按贡献程度排名 成员 岗位 工作内容 说明 Dean Founder 负责整体架构设计, 资源协调等 xi4oyi HRBP(Co-Founder) 福利、OKR 体系设计，团队文化建设等 tbDuck FE Owner 负责小程序前端 Newbg FE-RD 前端开发 IWTF FE-RD 前端开发 douNine BE-RD 后端开发 shirley PM 产品设计、规划 wuxuanz UI UI 设计 You Join us, come on! 团队文化 为创建良好的组织文化，帮助团队组织做好文化建设，不偏不倚的朝目标前进。团队通过讨论，形成了自身的 MVVS。 1.使命（Misson） 2.愿景（Vision） 3.价值观（Value） 4.价值观（Strategy） 协作机制 Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/report/":{"url":"wiki/report/","title":"Report","keywords":"","body":"工作内容 2019 年 4 月报告 5 月报告 2018 年 Q3 周报 Q4 周报 其他工作 学习体会 douNine Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/report/template.html":{"url":"wiki/report/template.html","title":"Report Template","keywords":"","body":"月报模板 示例 Weekly Meeting 2019w16 (04.15 ~ 04.21) Time: April 21, 2019 Moderator: @dean Notetaker: @dean Video/Slides: https://youtu.be/JFWi5yebR88 Moderator checklist: 确定参会人数及时间 是否需要视频或录屏 会议议题及沟通事项 提前准备工作计划 Attendees: @dean @tbDuck Agenda Topic: 下周工作 Notes: 技术突破 志愿者信息录入 小程序使用场景 扫码进入 微信好友分享 微信群组分享 Questions: Q: @dean, 为什么用 mpvue, 不用 wepy 呢？ A: 因为 mpvue 使用成本小，且当前已经支持各类小程序。对于我们来讲，是比较简单的 Comments: @dean 服务器资源紧急，我下周开始跟进。 ToDo: @dean: [ ] createqrcode 获取小程序二维码接口支持参数。 [d] : 救助站信息录入 @tbDuck: [ ] 用户手机号码获取，使用 button 组件 getPhoneNumber [ ] 用户收件地址获取，使用 api 接口 wx.chooseAddress [ ] 用户信息灰色进行提示，文本框支持编辑功能 [ ] 志愿者信息录入逻辑实现 @Newbg: [ ] 客服页面布局设计 @xi4oyi: [ ] 周会模板制定 使用说明 工作计划分为3段，第1段表示工作进度，第2段表示分类及优先级，第三段表示具体的工作内容。 a. 进度标识 [ ] : 设定工作计划 [x] : 已完成 [n] : 推迟下周开展 [c] : 下周继续 [d] : 删除该项工作计划 b. 分类标识 :new: : 新功能、新模块 :bug: : 设计缺陷、漏洞或者 bug, 可以正常迭代 :rotating_light: : 一级紧急, 生产 bug 且有一定用户影响 :red_circle: : 重要且紧急 :warning: : 重要不紧急 :golf: : 后续要做，先设定为计划 c. 工作内容 单条工作内容尽量不超过20个汉字，目标必须可以在9小时以内完成，且能够进行验证、验收 Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/bbs-deploy.html":{"url":"wiki/bbs-deploy.html","title":"Deployment","keywords":"","body":"论坛部署 主机初始化 1. 安装 Nginx `sudo yum install pcre-devel zlib-devel `./configure --prefix=/data/app/nginx --with-compat --add-dynamic-module=nginx-ipip-module `make && make install 日志清理 /etc/logrotate.d/nginx /data/app/nginx/logs/error.log { su work work create 0644 work work daily rotate 10 missingok notifempty compress sharedscripts postrotate /bin/kill -USR1 cat /data/app/nginx/run/nginx.pid 2>/dev/null 2>/dev/null || true endscript } 3. PHP71 安装 yum install epel-release rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm yum install php71w-xml php71w-process php71w-mbstring php71w-mysql php71w-gd php71w-common php71w-cli php71w-pear php71w-opcache php71w-bcmath php71w-pdo php71w-devel php71w-fpm php71w-pecl-imagick mod_php71w php71w-pecl-apcu /etc/php-fpm.d/www.conf 4. 设置安全组策略 1. 默认安全组放通全部端口 2. ssh http https icmp 3. default 5. 挂载cosfs /usr/local/bin/cosfs attachment-10016990 /mnt -ourl=cos.ap-shanghai.myqcloud.com -odbglevel=info -oallow_other PHP-FPM 配置 ; /etc/php-fpm.d/www.conf daemonize = yes [www] user = work group = work listen = 0.0.0.0:9000 ; listen.allowed_clients is any. ; listen.allowed_clients = 127.0.0.1,10.0.1.144 pm = dynamic pm.max_children = 50 pm.start_servers = 5 pm.min_spare_servers = 5 pm.max_spare_servers = 35 php_value[session.save_handler] = files php_value[session.save_path] = /var/lib/php/session php_value[soap.wsdl_cache_dir] = /var/lib/php/wsdlcache access.log = /data/logs/php-fpm/$pool.access.log access.format = \"%R %u %s %m %{HTTP_HOST}e%r?%q\" slowlog = /data/logs/php-fpm/php-www-slow.log php_admin_flag[log_errors] = on php_admin_value[error_log] = /data/logs/php-fpm/php-www-error.log chdir = /data/app/bbs.baobeihuijia.com Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/changelog.html":{"url":"wiki/changelog.html","title":"Changelog","keywords":"","body":"常见问题 表结构 Discuz!X/数据库字典 更新记录 1. UC通信息不成功 相关文件：config/config_ucenter.php, uc_server/data/config.inc.php 表：pre_ucenter_applications 说明：新 Discuz X3.4 集成了 uc-center, 所以配置路径不需要加/uc_center。 在页面可以抓到访问的地址是 https://bbs.example.com/api/./uc.php 处理方法： 1. uc_server/data/config.inc.php 中增加编码配置 define('CHARSET', 'utf-8'); 2. ucenter -> UCenter 设置 -> 检查 uc key 是否合法(与config_ucenter.php是否相同)， 确认后提交即可。 参考：https://jingyan.baidu.com/article/48b37f8d4745c21a646488a0.html 2. 复制短连接问题 文件：/template/default/forum/viewthread.htm 处理方法： 查找，lang share_url_copy , 删除此行中$fromuid。 参考：http://www.discuz.net/thread-3642983-1-1.html 3. 无上传按钮 原因：chrome不支持跨站点小swf文件访问 处理办法：static/js/upload.js static/js/swfupload.js 文件, swf地址改为 \"/static/image/common/swfupload.swf\" 不使用 CDN 地址, 直接走论坛站点。 4. 乱码问题 uc_server/data/config.inc.php 中增加编码配置 define('CHARSET', 'utf-8'); default/forum/discuz.htm newsetuser 显示乱码，暂时屏蔽了。后面找时间看。 5. Logo及图片问题 这个很好解决，给一个正确的地址和图片即可。 favicon.ico: 一定保证论坛文件正确，这个文件，不走 CDN 其他图片： 大多数是使用 CDN 的， 需要保证 CDN 上图片正确。 6. Discuz! 文章标题省略号 source/include/portalcp/portalcp_article.php $_POST['title'] = getstr(trim($_POST['title']) https://shipengliang.com/program-code/discuz-文章标题省略号如何去除.html http://www.discuz.net/forum.php?mod=viewthread&tid=3422733 ``` else if(mb_strlen(theform.subject.value) > 120)``` static/js/forum_post.js static/js/forum.js 7. 头像问题 source/function/function_core.php $ucenterurl = empty($ucenterurl) ? $_G['setting']['ucenterurl'] : $ucenterurl; 下方增加 $ucenterurl_s = '//avatar.baobeihuijia.com/uc_server'; $file = $ucenterurl.'/data/avatar/'.$dir1.'/'.$dir2.'/'.$dir3.'/'.substr($uid, -2).($real ? 'real' : '').'_avatar'.$size.'.jpg'; 替换为 $file = $ucenterurls.'/data/avatar/'.$dir1.'/'.$dir2.'/'.$dir3.'/'.substr($uid, -2).($real ? '_real' : '').'_avatar'.$size.'.jpg'; 8. 用户注册未定操作 针对重新创建过表的情况，建议检查 pre_ucenter_member 表，确保 uid 默认值不为 0， 且自增涨。 9. UC 通知失败 在默认 UC 正常通信的情况下，且使用 utf-8 站点时，应该是 xml文件格式是 ISO-8859-1 导致的 修改 uc_client/lib/xml.class.php 查找 2 处 SO-8859-1，并替换成 UTF-8。 10. 分类丢失问题 解决办法：管理中心-> 论坛 -> 版块管理 --> 编辑 --> 其他 --> 主题分类 --> 主题分类启用 --> 提交 11. 用户存在问题 思路：用户表主要存在 pre_common_member(关联贴子等论坛信息) 和 pre_ucenter_members (uc中心), 通过一处信息修复另外一处理即可。 uc 中用户丢失，修复时不会影响论坛贴子。 注意： 修复 pre_common_member 有可能会影响论坛贴子, 或修复不彻底问题。 本次操作两名用户：婧薇(pre_ucenter_members 数据丢失)，水质的流苏(pre_common_member 数据丢失) insert into pre_ucenter_members(uid,username,password,email,regip,regdate,salt) values() ; insert into pre_common_member(uid, email, username, password, regdate ) values() ; 绕月的云( pre_ucenter_members 数据丢失) 12. Discuz!您当前的访问请求当中含有非法字符，已经被系统拒绝解决办法 修改 ./source/class/discuz/discuz_application.php 文件。 参考 https://blog.csdn.net/lih062624/article/details/69388016 2019.04.18 分类：修改用户名 胥冰洁 -> 凯里糖果果 2019.04.24 分类: 帐号被删除 pre_common_member 表增加 蓝喵 2019.04.26 分类：修改用户名 用户名：西安雁塔小梅 改成 西安雁塔诗琪 用户名：沛县-安国-佳佳 改成 江苏道 2019.04.29 分类：修改用户名 用户名：秋水无痕1 改成 三平人生 修改用户名 用户名：王涛 改名 涛哥 (2019.04.30) 用户名：田茂荣 改名 眀德慧 (2019.05.06) webshell -> 花都东仔 2685390002 -> :x Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/new-project.html":{"url":"wiki/new-project.html","title":"New Project","keywords":"","body":"孵化项目 新论坛 网站原型 Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"wiki/reference.html":{"url":"wiki/reference.html","title":"reference","keywords":"","body":"文献 移动端产品 app: 网易云音乐 小程序: Godaddy 云助手 PC 端产品 web: xiaopiu.com 团队管理 周会及 OKR: IPFS Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "},"tags.html":{"url":"tags.html","title":"tags","keywords":"","body":"Tags Copyright © 2015-present airdb.            LastUpdated: 2020-01-03 05:29:04 "}}